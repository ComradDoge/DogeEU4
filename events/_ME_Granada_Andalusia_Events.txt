namespace = ME_Granada_Events

country_event = {
	id = ME_Granada_Events.1
	title = ME_Granada_Events.1.t #Reconquest of Upper Andalucia
	desc = ME_Granada_Events.1.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = ME_Granada_Events.1.a
		
		ai_chance = { factor = 0.5 }
		
		add_adm_power = 50
		add_dip_power = 50
		add_mil_power = 50
		
		custom_tooltip = " "
		
		4548 = {
			change_province_name = "Walba"
			rename_capital = "Walba"
		}
		
		custom_tooltip = " "
		
		1749 = {
			add_province_modifier = {
				name = GRA_lower_andalucia_conversion
				duration = -1
			}
		}
		224 = { 
			add_province_modifier = {
				name = GRA_lower_andalucia_conversion
				duration = -1
			}
		}
		225 = {
			add_province_modifier = {
				name = GRA_lower_andalucia_conversion
				duration = -1
			}
		}
		4548 = {
			add_province_modifier = {
				name = GRA_lower_andalucia_conversion
				duration = -1
			}
		}
		1748 = {
			add_province_modifier = {
				name = GRA_lower_andalucia_conversion
				duration = -1
			}
		}
	}
}

country_event = {
	id = ME_Granada_Events.2
	title = ME_Granada_Events.2.t #Reconquest of Cordoba province
	desc = ME_Granada_Events.2.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = ME_Granada_Events.2.a
		
		ai_chance = { factor = 0.5 }
		
		
	}
}

country_event = {
	id = ME_Granada_Events.3
	title = ME_Granada_Events.3.t #Reconquest of Al-Xarq (the east)
	desc = ME_Granada_Events.3.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	major = yes
	major_trigger = {
		GRA_interested_in_granada_trigger = yes
	}
	
	option = {
		name = ME_Granada_Events.3.a
		
		ai_chance = { factor = 0.5 }
		
		add_adm_power = 25
		add_dip_power = 25
		add_mil_power = 25 
		
		4550 = {
			change_province_name = "Hisn Khadral"
			rename_capital = "Hisn Khadral"
		}
		4547 = {
			change_province_name = "Al-Basit"
			rename_capital = "Al-Basit"
		}
	}
}

country_event = {
	id = ME_Granada_Events.4
	title = ME_Granada_Events.4.t #Reconquest of Al-Gharb (the west)
	desc = ME_Granada_Events.4.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	major = yes
	major_trigger = {
		GRA_interested_in_granada_trigger = yes
	}
	
	option = {
		name = ME_Granada_Events.4.a
		
		ai_chance = { factor = 0.5 }
		
		add_adm_power = 25
		add_dip_power = 25
		add_mil_power = 25 
		
		4787 = { change_province_name = "Shantarim" }
		4787 = { rename_capital = "Shantarim" }
		4150 = { change_province_name = "Jabura" }
		4150 = { rename_capital = "Jabura" }
	}
}

country_event = {
	id = ME_Granada_Events.5
	title = ME_Granada_Events.5.t #Reconquest of Middle March
	desc = ME_Granada_Events.5.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	major = yes
	major_trigger = {
		GRA_interested_in_granada_trigger = yes
	}
	
	option = {
		name = ME_Granada_Events.5.a
		
		ai_chance = { factor = 0.5 }
		
		add_adm_power = 25
		add_dip_power = 25
		add_mil_power = 25 
	}
}

country_event = {
	id = ME_Granada_Events.6
	title = ME_Granada_Events.6.t #Reconquest of Upper March
	desc = ME_Granada_Events.6.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	major = yes
	major_trigger = {
		GRA_interested_in_granada_trigger = yes
	}
	
	option = {
		name = ME_Granada_Events.6.a
		
		ai_chance = { factor = 0.5 }
		
		add_adm_power = 25
		add_dip_power = 25
		add_mil_power = 25 
	}
}

country_event = {
	id = ME_Granada_Events.7
	title = ME_Granada_Events.7.t #Reconquest of Lower March
	desc = ME_Granada_Events.7.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	major = yes
	major_trigger = {
		GRA_interested_in_granada_trigger = yes
	}
	
	option = {
		name = ME_Granada_Events.7.a
		
		ai_chance = { factor = 0.5 }
		
		add_adm_power = 25
		add_dip_power = 25
		add_mil_power = 25 
		
		
	}
}

country_event = {
	id = ME_Granada_Events.8
	title = ME_Granada_Events.8.t #Frontier Restored
	desc = ME_Granada_Events.8.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = ME_Granada_Events.8.a
		
		ai_chance = { factor = 0.5 }
		
		add_adm_power = 25
		add_dip_power = 25
		add_mil_power = 25 
	}
}

country_event = {
	id = ME_Granada_Events.9
	title = ME_Granada_Events.9.t #Castilian incident
	desc = ME_Granada_Events.9.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	fire_only_once = yes
	
	option = {
		name = ME_Granada_Events.9.a
		
		ai_chance = { factor = 1 }
		
		custom_tooltip = GRA_start_castillian_incident_tooltip
		set_country_flag = GRA_incident_castile
		swap_non_generic_missions = yes
	}
	
	option = {
		name = ME_Granada_Events.9.b
		
		ai_chance = { factor = 0 }
		
	}
}

country_event = {
	id = ME_Granada_Events.10
	title = ME_Granada_Events.10.t #Castilian incident
	desc = ME_Granada_Events.10.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	fire_only_once = yes
	
	option = {
		name = ME_Granada_Events.10.a
		
		ai_chance = { factor = 1 }
		
		add_loan = {
			interest_modifier = -2
			duration = 120
		}
		add_loan = {
			interest_modifier = -2
			duration = 120
		}
		add_loan = {
			interest_modifier = -2
			duration = 120
		}
		add_loan = {
			interest_modifier = -2
			duration = 120
		}
		add_loan = {
			interest_modifier = -2
			duration = 120
		}
		add_loan = {
			interest_modifier = -2
			duration = 120
		}
		add_loan = {
			interest_modifier = -2
			duration = 120
		}
		add_loan = {
			interest_modifier = -2
			duration = 120
		}
		add_loan = {
			interest_modifier = -2
			duration = 120
		}
		add_loan = {
			interest_modifier = -2
			duration = 120
		}
	}
	
	option = {
		name = ME_Granada_Events.10.b
		
		ai_chance = { factor = 0 }
		
		add_loan = {
			interest_modifier = -2
			duration = 120
		}
		add_loan = {
			interest_modifier = -2
			duration = 120
		}
		add_loan = {
			interest_modifier = -2
			duration = 120
		}
		add_loan = {
			interest_modifier = -2
			duration = 120
		}
		add_loan = {
			interest_modifier = -2
			duration = 120
		}
	}
	
	option = {
		name = ME_Granada_Events.10.c
		
		ai_chance = { factor = 0 }
		
		GRA_add_war_modifier = {
			name = GRA_we_are_doing_finetm
		}
	}
}

country_event = {
	id = ME_Granada_Events.11
	title = ME_Granada_Events.11.t #Forced Contribution
	desc = ME_Granada_Events.11.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = ME_Granada_Events.11.a
		
		ai_chance = { factor = 1 }
		
		add_age_modifier = {
			name = GRA_enforced_burgher_support
			duration = -1
			age = age_of_discovery
			else = "
				add_dip_power = 100
			"
		}
	}
	
	option = {
		name = ME_Granada_Events.11.b
		
		ai_chance = { factor = 0 }
		
		add_age_modifier = {
			name = GRA_enforced_nobles_support
			duration = -1
			age = age_of_discovery
			else = "
				add_mil_power = 100
			"
		}
	}
	
	option = {
		name = ME_Granada_Events.11.c
		
		ai_chance = { factor = 0 }
		
		add_age_modifier = {
			name = GRA_enforced_church_support
			duration = -1
			age = age_of_discovery
			else = "
				add_adm_power = 100
			"
		}
	}
	
	option = {
		name = ME_Granada_Events.11.e
		
		ai_chance = { factor = 0 }
		
		add_prestige_or_monarch_power = {
			amount = 10
		}
	}
}

country_event = {
	id = ME_Granada_Events.12
	title = ME_Granada_Events.12.t #
	desc = ME_Granada_Events.12.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = ME_Granada_Events.12.a
		
		ai_chance = { factor = 1 }
		
		add_dip_power = -100
		
		custom_tooltip = " "
		
		lower_andalucia_area = {
			add_core = ROOT
			remove_claim = ROOT
		}
	}
	
	option = {
		name = ME_Granada_Events.12.b
		
		ai_chance = { factor = 0 }
		
		add_prestige_or_monarch_power = { amount = 15 }
	}
}

country_event = {
	id = ME_Granada_Events.13
	title = ME_Granada_Events.13.t
	desc = ME_Granada_Events.13.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	fire_only_once = yes
	mean_time_to_happen = {
		months = 12
	}
	
	trigger = {
		tag = GRA
		is_rival = TLC
		NOT = { is_year = 1460 }
	}
	
	major = yes 
	
	major_trigger = { tag = TLC }
	
	option = {
		name = ME_Granada_Events.13.a
		
		ai_chance = { factor = 1 }
		
		barbary_coast_area = {
			add_claim = ROOT
		}
		add_mil_power = 25
	}
	
	option = {
		name = ME_Granada_Events.13.b
		
		ai_chance = { factor = 0 }
		
		custom_tooltip = GRA_in_case_of_war_with_castile
		remove_rival = TLC
		add_historical_friend = TLC
		
		TLC = { set_country_flag = TLC_help }
		TLC = { country_event = { id = ME_Granada_Events.14 } }
	}
}

country_event = {
	id = ME_Granada_Events.14
	title = ME_Granada_Events.14.t
	desc = ME_Granada_Events.14.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes 
	
	major = yes 
	
	major_trigger = { tag = GRA }
	
	option = {
		name = ME_Granada_Events.14.a
		
		ai_chance = { factor = 1 }
		
		remove_rival = FROM
		add_historical_friend = FROM
		upper_andalucia_area = {
			remove_claim = ROOT 
		}
	}
	
	option = {
		name = ME_Granada_Events.14.b
		
		ai_chance = { factor = 0 }
		
		add_prestige_or_monarch_power = { amount = 5 }
	}
}

country_event = {
	id = ME_Granada_Events.15
	title = ME_Granada_Events.15.t
	desc = ME_Granada_Events.15.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	mean_time_to_happen = { months = 12 }
	
	fire_only_once = yes
	trigger = {
		tag = TLC
		GRA = {
			war_with = CAS
			NOT = { war_with = TLC }
		}
		has_country_flag = GRA_in_case_of_war_with_castile
	}
	
	major = yes
	major_trigger = {
		tag = GRA
	}
	
	option = {
		name = ME_Granada_Events.15.a
		
		ai_chance = { factor = 1 }
		
		join_all_offensive_wars_of = GRA
		join_all_defensive_wars_of = GRA
	}
	
	option = {
		name = ME_Granada_Events.15.b
		
		ai_chance = { factor = 0 }
		
		add_prestige = -15
	}
}

country_event = {
	id = ME_Granada_Events.16 #berbers in baleares
	title = ME_Granada_Events.16.t
	desc = ME_Granada_Events.16.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			random_province = {
				limit = {
					country_or_non_sovereign_subject_holds = ROOT
					area = baleares_area
				}
				save_event_target_as = Granada_berber_province
			}
			random_owned_province = {
				limit = {
					area = baleares_area
				}
				save_event_target_as = Granada_berber_province
			}
		}
	}

	option = {
		name = ME_Granada_Events.16.a
		
		ai_chance = { factor = 1 }
		
		event_target:Granada_berber_province = {
			change_culture = berber
			add_base_tax = 2
			add_base_production = 1
			add_base_manpower = 2
		}
	}
	
	option = {
		name = ME_Granada_Events.16.b
		
		ai_chance = { factor = 0 }
		
		add_dip_power = 10
	}
}

country_event = {
	id = ME_Granada_Events.17 #muslims fleeing to Granada
	title = ME_Granada_Events.17.t
	desc = ME_Granada_Events.17.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			random_owned_province = {
				limit = {
					religion_group = muslim
					NOT = { is_capital_of = ROOT }
				}
				save_event_target_as = Granada_benefitting_province
			}
		}
	}

	option = {
		name = ME_Granada_Events.17.a
		
		ai_chance = { factor = 1 }
		
		event_target:Granada_benefitting_province = {
			add_base_tax = 2
			add_base_production = 2
			add_base_manpower = 2
			add_province_modifier = {
				name = GRA_fleeing_muslims
				duration = 10950
			}
		}
		
		capital_scope = {
			add_base_tax = 1
			add_base_production = 1
			add_base_manpower = 1
		}
	}
}

province_event = {
	id = ME_Granada_Events.18 #province converts to mozarabic
	title = ME_Granada_Events.18.t
	desc = ME_Granada_Events.18.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	mean_time_to_happen = {
		months = 60
		modifier = {
			factor = 5
			province_is_on_an_island = yes
		}
	}
	
	is_mtth_scaled_to_size = 1
	
	trigger = {
		owner = {
			has_country_flag = GRA_mozarabic
		}
		culture_group = iberian
		NOT = { culture = andalucian }
		NOT = { culture = mozarabic }
		NOT = { culture = sephardic }
		OR = {
			province_is_on_an_island = yes
			any_neighbor_province = {
				OR = {
					culture = andalucian
					AND = {
						culture = mozarabic
						had_province_flag = {
							flag = GRA_mozarabic_happened
							days = 5475
						}
					}
				}
				owner = {
					ROOT = {
						owned_by = PREV
					}
				}
			}
		}
		GRA_can_convert_to_mozarabic_trigger = yes
	}
	
	immediate = {
		hidden_effect = {
			change_culture = mozarabic
		}
	}

	option = {
		name = ME_Granada_Events.18.a
		
		ai_chance = { factor = 1 }
		
		set_province_flag = GRA_mozarabic_happened
		custom_tooltip = GRA_root_is_mozarabic
	}
}

province_event = {
	id = ME_Granada_Events.19 #province converts to andalusian
	title = ME_Granada_Events.19.t
	desc = ME_Granada_Events.19.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	mean_time_to_happen = {
		months = 60
	}
	
	is_mtth_scaled_to_size = 1
	
	trigger = {
		owner = {
			has_country_flag = GRA_mozarabic
		}
		culture_group = iberian
		NOT = { culture = andalucian }
		NOT = { culture = mozarabic }
		NOT = { culture = sephardic }
		OR = {
			culture = mozarabic
			had_province_flag = {
				flag = GRA_mozarabic_happened
				days = 14600
			}
		}
		GRA_can_convert_to_andalusian_trigger = yes
	}
	
	immediate = {
		hidden_effect = {
			change_culture = andalucian
		}
	}

	option = {
		name = ME_Granada_Events.19.a
		
		ai_chance = { factor = 1 }
		
		custom_tooltip = GRA_converted_to_andalucian
	}
}

country_event = {
	id = ME_Granada_Events.20 #Sephardic Jews
	title = ME_Granada_Events.20.t
	desc = ME_Granada_Events.20.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	mean_time_to_happen = {
		months = 60
	}
	
	trigger = {
		has_country_flag = GRA_jewish
		OR = {
			NOT = { has_country_flag = GRA_recent_jewish_event } 
			had_country_flag = {
				flag = GRA_recent_jewish_event
				days = 3650
			}
		}
		num_of_owned_provinces_with = {
			OR = {
				culture = andalucian
				culture = mozarabic
			}
			OR = { 
				development = 24
				province_has_center_of_trade_of_level = 1
			}
			GRA_can_convert_to_sephardic_trigger = yes
			value = 3
		}
	}
	
	immediate = {
		hidden_effect = {
			random_owned_province = {
				limit = {
					OR = {
						culture = andalucian
						culture = mozarabic
					}
					OR = { 
						development = 24
						province_has_center_of_trade_of_level = 1
					}
					GRA_can_convert_to_sephardic_trigger = yes
					NOT = { has_province_flag = GRA_chosen_for_event }
				}
				save_event_target_as = Granada_jewish_province_1
				set_province_flag = GRA_chosen_for_event
			}
			random_owned_province = {
				limit = {
					OR = {
						culture = andalucian
						culture = mozarabic
					}
					OR = { 
						development = 24
						province_has_center_of_trade_of_level = 1
					}
					GRA_can_convert_to_sephardic_trigger = yes
					NOT = { has_province_flag = GRA_chosen_for_event }
				}
				save_event_target_as = Granada_jewish_province_2
				set_province_flag = GRA_chosen_for_event
			}
			random_owned_province = {
				limit = {
					OR = {
						culture = andalucian
						culture = mozarabic
					}
					OR = { 
						development = 24
						province_has_center_of_trade_of_level = 1
					}
					GRA_can_convert_to_sephardic_trigger = yes
					NOT = { has_province_flag = GRA_chosen_for_event }
				}
				save_event_target_as = Granada_jewish_province_3
				set_province_flag = GRA_chosen_for_event
			}
		}
	}

	option = {
		name = ME_Granada_Events.20.a
		
		ai_chance = { factor = 1 }
		
		event_target:Granada_jewish_province_1 = {
			GRA_convert_to_sephardic = yes
		}
	}
	
	option = {
		name = ME_Granada_Events.20.b
		
		ai_chance = { factor = 1 }
		
		event_target:Granada_jewish_province_2 = {
			GRA_convert_to_sephardic = yes
		}
	}
	
	option = {
		name = ME_Granada_Events.20.c
		
		ai_chance = { factor = 1 }
		
		event_target:Granada_jewish_province_3 = {
			GRA_convert_to_sephardic = yes
		}
	}
	
	option = {
		name = ME_Granada_Events.20.e
		
		ai_chance = { factor = 1 }
	}
	
	after = {
		every_owned_province = {
			clr_province_flag = GRA_chosen_for_event
		}
	}
}

country_event = {
	id = ME_Granada_Events.21
	title = ME_Granada_Events.21.t
	desc = ME_Granada_Events.21.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes 
	
	immediate = {
		hidden_effect = {
			pick_best_provinces = {
				scope = iberia_region
				global_trigger = "
					owned_by = ROOT
					NOT = { province_id = 225 }
					NOT = { trade_goods = silk }
				"
				3 = yes
				scale = higher_development_than
				event_target_name = "Granada_target"
			}
		}
	}

	option = {
		name = ME_Granada_Events.21.a
		
		ai_chance = { factor = 1 }
		
		event_target:Granada_target_1 = {
			change_trade_goods = silk
		}
		event_target:Granada_target_2 = {
			change_trade_goods = silk
		}
		event_target:Granada_target_3 = {
			change_trade_goods = silk
		}
	}
	
	option = {
		name = ME_Granada_Events.21.b
		
		ai_chance = { factor = 1 }
		
		event_target:Granada_target_1 = {
			change_trade_goods = silk
		}
	}
	
	option = {
		name = ME_Granada_Events.21.c
		
		ai_chance = { factor = 1 }
		
		add_adm_power = 50
	}
}

country_event = {
	id = ME_Granada_Events.22
	title = ME_Granada_Events.22.t #Al-madin mine needs workforce!
	desc = ME_Granada_Events.22.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes 
	
	immediate = {
		
	}

	option = {
		name = ME_Granada_Events.22.a
		
		ai_chance = { factor = 1 }
		
		#fuggers. foreign banker option, give dhimmi equil, but take burgher one
		
		add_estate_loyalty_modifier = {
			estate = estate_burghers
			desc = GRA_fuggers
			loyalty = -5
			duration = 7300
		}
		
		add_estate_loyalty_modifier = {
			estate = estate_dhimmi
			desc = GRA_fuggers
			loyalty = 10
			duration = 7300
		}
		
		add_estate_influence_modifier = {
			estate = estate_dhimmi
			desc = GRA_fuggers
			influence = 15
			duration = 7300
		}

		2754 = {
			add_province_modifier = {
				name = GRA_some_investment
				duration = 3650
			}
			add_province_modifier = {
				name = GRA_new_labour
				duration = 9125
			}
		}
	}
	
	option = {
		name = ME_Granada_Events.22.b
		
		ai_chance = { factor = 1 }
		
		#get local dhimmi to "pay their jizya" this way
		add_estate_loyalty_modifier = {
			estate = estate_dhimmi
			desc = GRA_forced_dhimmi_to_work
			loyalty = -10
			duration = 9125
		}
		
		2754 = {
			add_province_modifier = {
				name = GRA_new_labour
				duration = 9125
			}
		}
	}
	
	option = {
		name = ME_Granada_Events.22.c
		
		ai_chance = { factor = 1 }
		
		#get the military to do something!
		add_country_modifier = {
			name = GRA_military_in_almaden
			duration = 9125
		}
		
		2754 = {
			add_province_modifier = {
				name = GRA_new_labour
				duration = 9125
			}
		}
	}
	
	option = {
		name = ME_Granada_Events.22.e
		
		ai_chance = { factor = 1 }
		
		#local laborers will do just fine
		add_dip_power = 10
	}
}

country_event = {
	id = ME_Granada_Events.23
	title = ME_Granada_Events.23.t #Gold Rush and the amalgation of mercury
	desc = ME_Granada_Events.23.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	fire_only_once = yes
	
	trigger = {
		tag = ADU
		owns_core_province = 2754
		calc_true_if = {
			colonial_california = {
				type = all
				is_city = yes
				owner = {
					NOT = {
						technology_group = north_american 
					}
				}
			}
			amount = 10
		}
	}

	immediate = {
		hidden_effect = {
			if = {
				limit = {
					owns_core_province = 224
				}
				224 = {
					save_event_target_as = GRA_naval_boost
				}
				set_country_flag = GRA_got_boost
			}
			else = {
				random_owned_province = {
					limit = {
						has_port = yes
					}
					owner = {
						set_country_flag = GRA_got_boost
					}
					save_event_target_as = GRA_naval_boost
				}
			}
		}
	}
	
	option = {
		name = ME_Granada_Events.23.a
		
		ai_chance = { factor = 1 }
		
		2754 = {
			add_province_modifier = {
				name = GRA_amalgamation_boost
				duration = -1
			}
		}
		if = {
			limit = {
				has_country_flag = GRA_got_boost
			}
			event_target:GRA_naval_boost = {
				add_province_modifier = {
					name = GRA_naval_boost_modifier
					duration = 9125
				}
			}
		}
	}
	after = {
		clr_country_flag = GRA_got_boost
	}
}

country_event = {
	id = ME_Granada_Events.24
	title = ME_Granada_Events.24.t
	desc = ME_Granada_Events.24.d
	picture = GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					any_known_country = {
						GRA_capital_in_mediterranean = yes
						ai = no
						NOT = { tag = ROOT }
						NOT = { is_subject = yes }
					}
				}
				pick_best_tags = {
					1 = yes
					global_trigger = "
						GRA_capital_in_mediterranean = yes
						ai = no
						NOT = { tag = ROOT }
						NOT = { is_subject = yes }
					"
					event_target_name = "Granada_Target_Player"
					scale = total_development
					scope = every_known_country
				}
				set_country_flag = GRA_24_player
				pick_best_tags = {
					2 = yes
					global_trigger = "
						GRA_capital_in_mediterranean = yes
						ai = yes
						NOT = { tag = ROOT }
						NOT = { is_subject = yes }
					"
					event_target_name = "Granada_Target"
					scale = total_development
					scope = every_known_country
				}
			}
			else = {
				pick_best_tags = {
					3 = yes
					global_trigger = "
						GRA_capital_in_mediterranean = yes
						ai = yes
						NOT = { tag = ROOT }
						NOT = { is_subject = yes }
					"
					event_target_name = "Granada_Target"
					scale = total_development
					scope = every_known_country
				}
			}
			if = {
				limit = {
					has_country_flag = GRA_24_player
				}
				event_target:Granada_Target_Player_1 = {
					GRA_silk_event_setup = yes
				}
				event_target:Granada_Target_1 = {
					GRA_silk_event_setup = yes
				}
				event_target:Granada_Target_2 = {
					GRA_silk_event_setup = yes
				}
			}
			else = {
				event_target:Granada_Target_1 = {
					GRA_silk_event_setup = yes
				}
				event_target:Granada_Target_2 = {
					GRA_silk_event_setup = yes
				}
				event_target:Granada_Target_3 = {
					GRA_silk_event_setup = yes
				}
			}
		}
	}
	
	
	option = {
		name = ME_Granada_Events.24.player
		
		ai_chance = { factor = 1 }
		
		trigger = {
			has_country_flag = GRA_24_player
		}
		
		event_target:Granada_Target_Player_1 = {
			GRA_offer_silk = yes
		}
		
		custom_tooltip = " "
		
		custom_tooltip = GRA_furthermore
		
		tooltip = {
			add_country_modifier = {
				name = GRA_offered_to_player
				duration = 7300
			}
		}
		set_country_flag = GRA_offered_to_player_flag
	}
	
	option = {
		name = ME_Granada_Events.24.a
		
		ai_chance = {
			factor = 1 
			modifier = {
				factor = 0
				has_country_flag = GRA_24_player
			}
		}
		
		event_target:Granada_Target_1 = {
			GRA_offer_silk = yes
		}
	}
	
	option = {
		name = ME_Granada_Events.24.b
		
		ai_chance = {
			factor = 1 
			modifier = {
				factor = 0
				has_country_flag = GRA_24_player
			}
		}
		
		event_target:Granada_Target_2 = {
			GRA_offer_silk = yes
		}
		
		custom_tooltip = " "
		
		custom_tooltip = GRA_furthermore
		
		tooltip = {
			add_country_modifier = {
				name = GRA_offered_to_second_ai
				duration = 7300
			}
		}
		set_country_flag = GRA_offered_to_second_ai_flag
	}
	
	option = {
		name = ME_Granada_Events.24.c
		
		ai_chance = {
			factor = 1 
			modifier = {
				factor = 0
				has_country_flag = GRA_24_player
			}
		}
		
		trigger = {
			NOT = { has_country_flag = GRA_24_player }
		}
		
		event_target:Granada_Target_3 = {
			GRA_offer_silk = yes
		}
		
		custom_tooltip = " "
		
		custom_tooltip = GRA_furthermore
		
		tooltip = {
			add_country_modifier = {
				name = GRA_offered_to_third_ai
				duration = 7300
			}
		}
		set_country_flag = GRA_offered_to_third_ai_flag
	}
	
	after = {
		clr_country_flag = GRA_24_player
	}
}

country_event = {
	id = ME_Granada_Events.25
	title = ME_Granada_Events.25.t
	desc = ME_Granada_Events.25.d
	picture = GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes 
	major = yes
	major_trigger = {
		GRA_capital_in_mediterranean = yes
	}
	
	option = {
		name = ME_Granada_Events.25.a
		
		ai_chance = {
			factor = 1 
			modifier = {
				factor = 0
				has_country_flag = GRA_24_player
			}
		}
		
		GRA_pay_FROM_for_silk = yes
	}
	
	option = {
		name = ME_Granada_Events.25.b
		
		ai_chance = {
			factor = 0
		}
		
		add_prestige = -10
	}
	
	after = {
		FROM = {
			clr_country_flag = GRA_offered_to_third_ai_flag
			clr_country_flag = GRA_offered_to_second_ai_flag
			clr_country_flag = GRA_offered_to_player_flag
		}
		event_target:Granada_Target_Player_1 = {
			set_variable = {
				which = Granada_24_years_of_income
				value = 0
			}
		}
		event_target:Granada_Target_1 = {
			set_variable = {
				which = Granada_24_years_of_income
				value = 0
			}
		}
		event_target:Granada_Target_2 = {
			set_variable = {
				which = Granada_24_years_of_income
				value = 0
			}
		}
		event_target:Granada_Target_3 = {
			set_variable = {
				which = Granada_24_years_of_income
				value = 0
			}
		}
	}
}

country_event = {
	id = ME_Granada_Events.26
	title = ME_Granada_Events.26.t #simple event chain leading to rise of Ummayads
	desc = ME_Granada_Events.26.d
	picture = GOOD_WITH_MONARCH_eventPicture

	fire_only_once = yes
	
	mean_time_to_happen = {
		months = 60
	}
	
	trigger = {
		tag = ADU
		at_war_with_religious_enemy = yes
	}
	
	immediate = {
		set_saved_name = {
			key = GRA_ummayad
			type = advisor
			scope = ROOT
		}
	}
	
	option = {
		name = ME_Granada_Events.26.a
		
		ai_chance = {
			factor = 1 
		}
		
		add_country_modifier = {
			name = GRA_ummayad_modifier_1
			duration = -1
		}
		
		hidden_effect = {
			country_event = { id = ME_Granada_Events.27 days = 365 random = 365 }
		}
	}
}

country_event = {
	id = ME_Granada_Events.27
	title = ME_Granada_Events.27.t
	desc = ME_Granada_Events.27.d
	picture = GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes 
	
	option = {
		name = ME_Granada_Events.27.a
		
		ai_chance = {
			factor = 1 
		}
		
		remove_country_modifier = GRA_ummayad_modifier_1
		add_country_modifier = {
			name = GRA_ummayad_modifier_2
			duration = -1
		}
		
		hidden_effect = {
			country_event = { id = ME_Granada_Events.28 days = 365 random = 365 }
		}
	}
}

country_event = {
	id = ME_Granada_Events.28
	title = ME_Granada_Events.28.t
	desc = ME_Granada_Events.28.d
	picture = GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes 
	
	option = {
		name = ME_Granada_Events.28.a
		
		ai_chance = {
			factor = 1 
		}
		
		remove_country_modifier = GRA_ummayad_modifier_2
		add_country_modifier = {
			name = GRA_ummayad_modifier_3
			duration = -1
		}
		
		hidden_effect = {
			country_event = { id = ME_Granada_Events.29 days = 365 random = 365 }
		}
	}
}

country_event = {
	id = ME_Granada_Events.29
	title = ME_Granada_Events.29.t
	desc = ME_Granada_Events.29.d
	picture = GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes 
	
	option = {
		name = ME_Granada_Events.29.a
		
		ai_chance = {
			factor = 1 
		}
		
		remove_country_modifier = GRA_ummayad_modifier_3
		add_country_modifier = {
			name = GRA_ummayad_modifier_4
			duration = -1
		}
		
		hidden_effect = {
			country_event = { id = ME_Granada_Events.30 days = 365 random = 365 } #the final
		}
	}
}


country_event = {
	id = ME_Granada_Events.30
	title = ME_Granada_Events.30.t
	desc = ME_Granada_Events.30.d
	picture = GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes 
	
	immediate = {
		hidden_effect = {
			pick_best_provinces = {
				scope = every_owned_province
				3 = yes
				global_trigger = ""
				scale = higher_development_than
				event_target_name = "Granada_Target"
			}
			random_list = {
				20 = { set_country_flag = GRA_shock_ummayad }
				20 = { set_country_flag = GRA_fire_ummayad }
				20 = { set_country_flag = GRA_manuever_ummayad }
				20 = { set_country_flag = GRA_siege_ummayad }
				20 = { }
			}
		}
	}
	
	option = {
		name = ME_Granada_Events.30.a
		
		ai_chance = {
			factor = 1 
		}
		
		add_yearly_manpower = -1 
		remove_country_modifier = GRA_ummayad_modifier_4
		
		event_target:Granada_Target_3 = {
			spawn_rebels = {
				size = 4
				leader = GRA_ummayad
				type = pretender_rebels
			}
		}
	}
	
	option = {
		name = ME_Granada_Events.30.b
		
		ai_chance = {
			factor = 1 
		}
		add_stability_or_adm_power = yes
		
		remove_country_modifier = GRA_ummayad_modifier_4
		
		custom_tooltip = " "
		
		define_ruler = {
			name = GRA_ummayad
			dynasty = "Ummayad"
			adm = 5
			dip = 4
			mil = 4
			age = 20
			claim = 75
		}
		
		if = {
			limit = {
				has_country_flag = GRA_shock_ummayad
			}
			define_ruler_to_general = {
				fire = 3
				shock = 6
				manuever = 2
				siege = 1
			}
		}
		else_if = {
			limit = {
				has_country_flag = GRA_fire_ummayad
			}			
			define_ruler_to_general = {
				fire = 4
				shock = 3
				manuever = 2
				siege = 2
			}
		}
		else_if = {
			limit = {
				has_country_flag = GRA_manuever_ummayad
			}
			
			define_ruler_to_general = {
				fire = 2
				shock = 5
				manuever = 6
				siege = 2
			}
		}
		else_if = {
			limit = {
				has_country_flag = GRA_siege_ummayad
			}
			define_ruler_to_general = {
				fire = 4
				shock = 2
				manuever = 3
				siege = 4
			}
		}
		else = {
			define_ruler_to_general = {
				fire = 3
				shock = 3
				manuever = 4
				siege = 2
			}
		}
		
		if = {
			limit = {
				NOT = { ME_is_caliphate_trigger = yes }
			}
			override_country_name = GRA_ummayads
		}
		
		if = {
			limit = {
				has_heir = yes
			}
			kill_heir = { allow_new_heir = no }
		}
	}
	
	after = {
		clr_country_flag = GRA_shock_ummayad
		clr_country_flag = GRA_fire_ummayad
		clr_country_flag = GRA_manuever_ummayad
		clr_country_flag = GRA_siege_ummayad
	}
}

country_event = {
	id = ME_Granada_Events.31
	title = ME_Granada_Events.31.t
	desc = ME_Granada_Events.31.d
	picture = GOOD_WITH_MONARCH_eventPicture

	trigger = {
		has_country_flag = GRA_experts_fire_me
	}
	
	mean_time_to_happen = {
		months = 1
	}
	
	immediate = {
		hidden_effect = {
			clr_country_flag = GRA_experts_fire_me
			pick_best_tags = {
				scale = prestige 
				global_trigger = "
					NOT = { tag = ROOT }
					OR = {
						capital_scope = { continent = europe }
						GRA_capital_in_mediterranean = yes
						technology_group = muslim
						technology_group = western
						technology_group = eastern
					}
				"
				5 = yes
				scope = every_known_country
				event_target_name = "Granada_Recruitment_Target"
			}
			
			trigger_switch = { #valuates the amount of stab to give bonus
				on_trigger = stability
				3 = {
					GRA_give_every_target_reduction = { amount = 10 }
				}
				2 = {
					GRA_give_every_target_reduction = { amount = 5 }
				}
			}
			
			trigger_switch = { #evaluates amount of dip rep to give a bonus
				on_trigger = diplomatic_reputation
				5 = {
					GRA_give_every_target_reduction = { amount = 15 }
				}
				4 = {
					GRA_give_every_target_reduction = { amount = 10 }
				}
				3 = {
					GRA_give_every_target_reduction = { amount = 5 }
				}
			}
			
			if = {
				limit = {
					has_country_flag = GRA_5_extra_advisor_flag
				}
				GRA_give_every_target_reduction = { amount = 5 }
			}
			
			GRA_every_target_opinion_evaluation = yes #evaluates the opinion of the target country to assign a reduction of maximum of -35%
			
			GRA_assign_reduction_based_on_tolerance = yes #evaluates the ROOT tolerance of the religion to give a bonus of 0 to -25% 
			
			GRA_pick_advisors = yes
		}
	}
	
	option = {
		name = ME_Granada_Events.31.a
		
		ai_chance = {
			factor = 1 
		}
		
		GRA_pick_advisor_from = { id = 1 }
	}
	
	option = {
		name = ME_Granada_Events.31.b
		
		ai_chance = {
			factor = 1 
		}
		
		GRA_pick_advisor_from = { id = 2 }
	}
	
	option = {
		name = ME_Granada_Events.31.c
		
		ai_chance = {
			factor = 1 
		}
		
		GRA_pick_advisor_from = { id = 3 }
	}
	
	option = {
		name = ME_Granada_Events.31.e
		
		ai_chance = {
			factor = 1 
		}
		
		GRA_pick_advisor_from = { id = 4 }
	}
	
	option = {
		name = ME_Granada_Events.31.f
		
		ai_chance = {
			factor = 1 
		}
		
		GRA_pick_advisor_from = { id = 5 }
	}
	
	after = {
		GRA_clear_flags = yes
		change_variable = { which = Granada_amount_of_recruitments value = 1 }
	}
}

country_event = {
	id = ME_Granada_Events.32
	title = ME_Granada_Events.32.t
	desc = ME_Granada_Events.32.d
	picture = GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes 
	
	option = {
		name = ME_Granada_Events.32.a
		
		ai_chance = {
			factor = 1 
		}
		
		add_adm_power = 50
		add_prestige_or_monarch_power = { amount = 10 }
	}
}

country_event = {
	id = ME_Granada_Events.33
	title = ME_Granada_Events.33.t
	desc = ME_Granada_Events.33.d
	picture = GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes 
	
	option = {
		name = ME_Granada_Events.33.a
		
		ai_chance = {
			factor = 1 
		}
		
		add_adm_power = 25
		add_country_modifier = {
			name = GRA_adm_policy
			duration = -1
		}
	}
	
	option = {
		name = ME_Granada_Events.33.b
		
		ai_chance = {
			factor = 1 
		}
		
		add_dip_power = 25
		add_country_modifier = {
			name = GRA_dip_policy
			duration = -1
		}
	}
	
	option = {
		name = ME_Granada_Events.33.c
		
		ai_chance = {
			factor = 1 
		}
		
		add_mil_power = 25
		add_country_modifier = {
			name = GRA_mil_policy
			duration = -1
		}
	}
}

country_event = {
	id = ME_Granada_Events.34
	title = ME_Granada_Events.34.t
	desc = ME_Granada_Events.34.d
	picture = GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes 
	
	option = {
		name = ME_Granada_Events.34.a
		
		ai_chance = {
			factor = 1 
		}
		
		trigger = {
			has_country_flag = GRA_military_preview
		}
		
		clr_country_flag = GRA_military_preview
		custom_tooltip = GRA_end_the_preview
	}
	
	option = {
		name = ME_Granada_Events.34.b
		
		ai_chance = {
			factor = 1 
		}
		
		trigger = {
			NOT = { has_country_flag = GRA_muslim_military_flag }
		}
		
		clr_country_flag = GRA_western_military_flag
		set_country_flag = GRA_muslim_military_flag
		set_country_flag = GRA_military_preview
		custom_tooltip = GRA_preview_muslim_military
	}
	
	option = {
		name = ME_Granada_Events.34.c
		
		ai_chance = {
			factor = 0 
		}
		
		trigger = {
			NOT = { has_country_flag = GRA_western_military_flag }
		}
		
		clr_country_flag = GRA_muslim_military_flag
		set_country_flag = GRA_western_military_flag
		set_country_flag = GRA_military_preview
		custom_tooltip = GRA_preview_western_military
	}
	
	option = {
		name = ME_Granada_Events.34.e
		
		ai_chance = {
			factor = 0 
		}
		
		trigger = {
			has_country_flag = GRA_military_preview
		}
	}
	
	after = {
		set_country_flag = GRA_chose_military_path
		swap_non_generic_missions = yes
	}
}

country_event = {
	id = ME_Granada_Events.35
	title = ME_Granada_Events.35.t
	desc = ME_Granada_Events.35.d
	picture = GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes 
	
	option = {
		name = ME_Granada_Events.35.a
		
		ai_chance = {
			factor = 1 
		}
		
		set_country_flag = GRA_defeat_france_flag
		custom_tooltip = GRA_choose_defeat_france
	}
	
	option = {
		name = ME_Granada_Events.35.b
		
		ai_chance = {
			factor = 1 
		}
		
		set_country_flag = GRA_ally_france_flag
		custom_tooltip = GRA_choose_ally_france
	}
	
	after = {
		swap_non_generic_missions = yes
	}
}

country_event = {
	id = ME_Granada_Events.36
	title = ME_Granada_Events.36.t
	desc = ME_Granada_Events.36.d
	picture = GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes 
	
	major = yes
	
	option = {
		name = ME_Granada_Events.36.a
		
		ai_chance = {
			factor = 1 
		}
		
		custom_tooltip = GRA_spread_of_islam_will_accelerate
		set_global_flag = GRA_spread_of_islam_will_accelerate
	}
	
}

country_event = {
	id = ME_Granada_Events.37
	title = ME_Granada_Events.37.t
	desc = ME_Granada_Events.37.d
	picture = GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes 
	major = yes
	major_trigger = {
		tag = FROM
	}
	
	option = {
		name = ME_Granada_Events.37.a
		
		ai_chance = {
			factor = 1 
		}
		
		highlight = yes 
		trigger = {
			custom_trigger_tooltip = {
				tooltip = GRA_triggered_this
			}
		}
		
		define_advisor = {
			type = theologian
			skill = 3
			culture = FROM
			religion = FROM
			cost_multiplier = 0.25
		}
	}
}

country_event = {
	id = ME_Granada_Events.38
	title = ME_Granada_Events.38.t
	desc = ME_Granada_Events.38.d
	picture = GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes 
	
	major = yes
	
	option = {
		name = ME_Granada_Events.38.a
		
		ai_chance = {
			factor = 1 
		}
		
		override_country_name = GRA_khilafat_qurtubah
		ME_become_caliphate_effect = yes 
	}
}

country_event = {
	id = ME_Granada_Events.39
	title = ME_Granada_Events.39.t
	desc = ME_Granada_Events.39.d
	picture = GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes 
	
	major = yes
	major_trigger = {
		religion_group = muslim
	}
	
	option = {
		name = ME_Granada_Events.39.a
		
		ai_chance = {
			factor = 1 
		}
		
		custom_tooltip = GRA_every_muslim_country
		hidden_effect = {
			maghreb_region = {
				limit = {
					is_capital = yes
					owner = {
						total_development = 100
						religion_group = muslim
						NOT = { is_enemy = ROOT }
						NOT = { is_rival = ROOT }
					}
				}
				add_institution_embracement = {
					which = renaissance
					value = 50
				}
			}
			egypt_region = {
				limit = {
					is_capital = yes
					owner = {
						total_development = 100
						religion_group = muslim
						NOT = { is_enemy = ROOT }
						NOT = { is_rival = ROOT }
					}
				}
				add_institution_embracement = {
					which = renaissance
					value = 25
				}
			}
			mashriq_region = {
				limit = {
					is_capital = yes
					owner = {
						total_development = 100
						religion_group = muslim
						NOT = { is_enemy = ROOT }
						NOT = { is_rival = ROOT }
					}
				}
				add_institution_embracement = {
					which = renaissance
					value = 25
				}
			}
			anatolia_region = {
				limit = {
					is_capital = yes
					owner = {
						total_development = 100
						religion_group = muslim
						NOT = { is_enemy = ROOT }
						NOT = { is_rival = ROOT }
					}
				}
				add_institution_embracement = {
					which = renaissance
					value = 25
				}
			}
		}
	}
}

country_event = {
	id = ME_Granada_Events.40
	title = ME_Granada_Events.40.t
	desc = ME_Granada_Events.40.d
	picture = GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes 
	
	major = yes
	major_trigger = {
		religion_group = muslim
	}
	
	option = {
		name = ME_Granada_Events.40.a
		
		ai_chance = {
			factor = 1 
		}
		
		ME_add_power_projection = { amount = 25 }
		
		custom_tooltip = " "
		
		add_country_modifier = {
			name = GRA_capture_of_caliph
			duration = 10950
		}
	}
}

province_event = {
	id = ME_Granada_Events.41
	title = ME_Granada_Events.41.t
	desc = ME_Granada_Events.41.d
	picture = GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes 
	
	option = {
		name = ME_Granada_Events.41.a
		
		ai_chance = {
			factor = 1 
		}
		
		change_trade_goods = paper
	}
	
	option = {
		name = ME_Granada_Events.41.b
		
		ai_chance = {
			factor = 1 
		}
		
		owner = {
			add_prestige_or_monarch_power = { amount = 10 }
		}
	}
}


country_event = {
	id = ME_Granada_Events.42
	title = ME_Granada_Events.42.t
	desc = ME_Granada_Events.42.d
	picture = GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes 
	
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					num_of_owned_provinces_with = {
						culture = algerian
						value = 3
					}
				}
				set_country_flag = GRA_3_berber_provs
				pick_best_provinces = {
					3 = yes
					scope = every_owned_province
					global_trigger = " culture = algerian "
					scale = higher_development_than
					event_target_name = "Granada_Target"
				}
			}
			else_if = {
				limit = {
					num_of_owned_provinces_with = {
						culture = algerian
						value = 2
					}
				}
				set_country_flag = GRA_2_berber_provs
				pick_best_provinces = {
					2 = yes
					scope = every_owned_province
					global_trigger = " culture = algerian "
					scale = higher_development_than
					event_target_name = "Granada_Target"
				}
			}
			else_if = {
				limit = {
					any_owned_province = {
						culture = algerian
					}
				}
				set_country_flag = GRA_1_berber_provs
				random_owned_province = {
					limit = {
						culture = algerian
					}
					save_event_target_as = Granada_Target_1
				}
			}
			else = { } #do nothing
		}
	}
	
	option = {
		name = ME_Granada_Events.42.a #favor the berbers
		
		ai_chance = {
			factor = 1 
		}
		
		trigger = {
			OR = {
				has_country_flag = GRA_3_berber_provs
				has_country_flag = GRA_2_berber_provs
				has_country_flag = GRA_1_berber_provs
			}
		}
		if = {
			limit = {
				OR = {
					has_country_flag = GRA_3_berber_provs
					has_country_flag = GRA_2_berber_provs
					has_country_flag = GRA_1_berber_provs
				}
			}
			event_target:Granada_Target_1 = {
				change_culture = berber
				add_base_tax = 1
				add_base_manpower = 2
			}
		}
		if = {
			limit = {
				OR = {
					has_country_flag = GRA_2_berber_provs
					has_country_flag = GRA_3_berber_provs
				}
			}
			event_target:Granada_Target_2 = {
				change_culture = berber
				add_base_tax = 1
				add_base_manpower = 2
			}
		}
		if = {
			limit = {
				has_country_flag = GRA_3_berber_provs
			}
			event_target:Granada_Target_3 = {
				change_culture = berber
				add_base_tax = 1
				add_base_manpower = 2
			}
		}
		
	}
	
	option = {
		name = ME_Granada_Events.42.b #favor the algerians
		
		ai_chance = {
			factor = 0 
		}
		
		add_accepted_culture_or_dip_power = { culture = algerian }
	}
	
	after = {
		clr_country_flag = GRA_3_berber_provs
		clr_country_flag = GRA_2_berber_provs
		clr_country_flag = GRA_1_berber_provs
	}
}

province_event = {
	id = ME_Granada_Events.43
	title = ME_Granada_Events.43.t
	desc = ME_Granada_Events.43.d
	picture = GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes 
	
	option = {
		name = ME_Granada_Events.43.a #favor the berbers
		
		ai_chance = {
			factor = 1 
		}
	
		
	}
}

country_event = {
	id = ME_Granada_Events.44
	title = ME_Granada_Events.44.t
	desc = ME_Granada_Events.44.d
	picture = GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes 
	major = yes 
	
	option = {
		name = ME_Granada_Events.44.a
		
		ai_chance = {
			factor = 1 
		}
	
		change_price = {
			trade_goods = sugar
			key = GRA_andalusian_cash_crop_trade
			value = 0.2
			duration = 10950
		}
		change_price = {
			trade_goods = tobacco
			key = GRA_andalusian_cash_crop_trade
			value = 0.2
			duration = 10950
		}
		change_price = {
			trade_goods = cotton
			key = GRA_andalusian_cash_crop_trade
			value = 0.2
			duration = 10950
		}
		change_price = {
			trade_goods = cocoa
			key = GRA_andalusian_cash_crop_trade
			value = 0.2
			duration = 10950
		}
	}
}

# country_event = {
	# id = ME_Granada_Events.45
	# title = ME_Granada_Events.45.t
	# desc = ME_Granada_Events.45.d
	# picture = GOOD_WITH_MONARCH_eventPicture

	# is_triggered_only = yes 
	# major = yes 
	
	# option = {
		# name = ME_Granada_Events.45.a
		
		# ai_chance = {
			# factor = 1 
		# }
	

	# }
# }

country_event = {
	id = ME_Granada_Events.46
	title = ME_Granada_Events.46.t
	desc = ME_Granada_Events.46.d
	picture = GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes 
	
	option = {
		name = ME_Granada_Events.46.a
		
		ai_chance = {
			factor = 1 
		}
	
		change_unit_type = western
	}
	
	option = {
		name = ME_Granada_Events.46.b
		
		ai_chance = {
			factor = 1 
		}
	
		add_mil_power = 200
		add_army_professionalism = 0.1
	}
}

country_event = {
	id = ME_Granada_Events.47
	title = ME_Granada_Events.47.t
	desc = ME_Granada_Events.47.d
	picture = GOOD_WITH_MONARCH_eventPicture

	trigger = {
		has_country_flag = GRA_incident_castile
		NOT = { war_with = CAS }
	} 
	
	option = {
		name = ME_Granada_Events.47.a
		
		ai_chance = {
			factor = 1 
		}
	
		GRA_end_incident = yes
	}
}

country_event = {
	id = ME_Granada_Events.48
	title = ME_Granada_Events.48.t
	desc = ME_Granada_Events.48.d
	picture = GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes 
	
	immediate = {
		event_target:Granada_that_target = {
			set_country_flag = GRA_event_chain_concluded
		}
		hidden_effect = {
			save_event_target_as = Granada_granada_target
		}
	}
	
	option = {
		name = ME_Granada_Events.48.a
		
		ai_chance = {
			factor = 1 
		}
	
		event_target:Granada_that_target = {
			country_event = { id = ME_Granada_Events.49 }
		}
		
		custom_tooltip = GRA_we_will_send_a_mission
	}
}

country_event = {
	id = ME_Granada_Events.49
	title = ME_Granada_Events.49.t
	desc = ME_Granada_Events.49.d
	picture = GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes 
	
	immediate = {
		hidden_effect = {
			random_owned_province = {
				save_event_target_as = Gra_religious_mission_province
			}
			
			random_owned_province = {
				limit = { 
					religion = ROOT
				}
				save_event_target_as = Gra_religious_mission_province
			}
		}
	}
	
	option = {
		name = ME_Granada_Events.49.a
		
		ai_chance = {
			factor = 1 
			
			modifier = {
				factor = 0.25
				
				GRA_doesnt_want_mission_trigger = yes
			}
			
			modifier = {
				factor = 0
				
				GRA_deal_breaker = yes
			}
			
			modifier = {
				factor = 2
				
				GRA_wants_mission_trigger = yes
			}
		}
	
		change_variable = { which = GRA_conversion value = 1 }
		
		event_target:Gra_religious_mission_province = {
			add_province_modifier = {
				name = GRA_local_muslim_mission
				duration = -1
			}
		}
	}
	
	option = {
		name = ME_Granada_Events.49.b
		
		ai_chance = {
			factor = 1 
			
			modifier = {
				factor = 2
				
				GRA_doesnt_want_mission_trigger = yes
			}
			
			modifier = {
				factor = 0.25
				
				GRA_wants_mission_trigger = yes
			}
		}
	
		change_variable = { which = GRA_conversion value = -1 }
		
		add_mil_power = -50
	}
	
	after = {
		country_event = { id = ME_Granada_Events.50 days = 30 random = 60 }
	}
}

country_event = {
	id = ME_Granada_Events.50
	title = ME_Granada_Events.50.t
	desc = ME_Granada_Events.50.d
	picture = GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes 
	
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					NOT = {
						event_target:Gra_religious_mission_province = {
							owned_by = ROOT
						}
					}
				}
				random_owned_province = {
					save_event_target_as = Gra_religious_mission_province
				}
				
				random_owned_province = {
					limit = { 
						religion = ROOT
					}
					save_event_target_as = Gra_religious_mission_province
				}
			}
		}
	}
	option = {
		name = ME_Granada_Events.50.a
		
		ai_chance = {
			factor = 1 
			
			modifier = {
				factor = 0.25
				
				GRA_doesnt_want_mission_trigger = yes
			}
			
			modifier = {
				factor = 0
				
				GRA_deal_breaker = yes
			}
			
			modifier = {
				factor = 2
				
				GRA_wants_mission_trigger = yes
			}
		}
	
		change_variable = { which = GRA_conversion value = 1 }
		
		event_target:Gra_religious_mission_province = {
			spawn_rebels = {
				type = religious_rebels
				size = 1
			}
		}
				
		random_list = {
			50 = {
				event_target:Gra_religious_mission_province = {
					change_religion = event_target:Granada_granada_target
				}
			}
			50 = {
			}
		}
	}
	
	option = {
		name = ME_Granada_Events.50.b
		
		ai_chance = {
			factor = 1 
			
			modifier = {
				factor = 2
				
				GRA_doesnt_want_mission_trigger = yes
			}
			
			modifier = {
				factor = 0.25
				
				GRA_wants_mission_trigger = yes
			}
		}
	
		change_variable = { which = GRA_conversion value = -1 }
		
		add_prestige = -10
	}
	
	after = {
		country_event = { id = ME_Granada_Events.51 days = 30 random = 60 }
	}
}

country_event = {
	id = ME_Granada_Events.51
	title = ME_Granada_Events.51.t
	desc = ME_Granada_Events.51.d
	picture = GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes 
	
	option = {
		name = ME_Granada_Events.51.a
		
		ai_chance = {
			factor = 1 
			
			modifier = {
				factor = 0.25
				
				GRA_doesnt_want_mission_trigger = yes
			}
			
			modifier = {
				factor = 0
				
				GRA_deal_breaker = yes
			}
			
			modifier = {
				factor = 2
				
				GRA_wants_mission_trigger = yes
			}
		}
	
		change_variable = { which = GRA_conversion value = 1 }
		
		add_dip_power = 100
	}
	
	option = {
		name = ME_Granada_Events.51.b
		
		ai_chance = {
			factor = 1 
			
			modifier = {
				factor = 2
				
				GRA_doesnt_want_mission_trigger = yes
			}
			
			modifier = {
				factor = 0.25
				
				GRA_wants_mission_trigger = yes
			}
		}
	
		change_variable = { which = GRA_conversion value = -1 }
		
		add_prestige_or_monarch_power = { amount = 25 }
		add_legitimacy = 25
	}
	
	after = {
		country_event = { id = ME_Granada_Events.52 days = 30 random = 60 } #finish
	}
}

country_event = {
	id = ME_Granada_Events.52
	title = ME_Granada_Events.52.t
	desc = ME_Granada_Events.52.d
	picture = GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes 
	
	immediate = {
		clr_country_flag = GRA_event_chain_concluded
	}
	option = {
		name = ME_Granada_Events.52.a
		
		ai_chance = {
			factor = 1 
		}
	
		
	}
	
	option = {
		name = ME_Granada_Events.52.b
		
		ai_chance = {
			factor = 100 
		}
		
		trigger = {
			check_variable = { which = GRA_conversion value = 1 }
		}
	
		change_religion = event_target:Granada_granada_target
		set_ruler_religion = event_target:Granada_granada_target
		if = {
			limit = {
				has_heir = yes
			}
			set_heir_religion = event_target:Granada_granada_target
		}
		if = {
			limit = {
				has_consort = yes
			}
			set_consort_religion = event_target:Granada_granada_target
		}
	}
	
	after = {
		clr_country_flag = GRA_religious_mission_sent_here
		event_target:Granada_granada_target = {
			clr_country_flag = GRA_running_a_religious_mission
		}
	}
}