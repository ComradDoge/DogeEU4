# Missions Expanded on actions
# Remember to keep the vanilla effects

# province
on_adm_development = {
	#ME Stuff
	
	ME_on_development = yes
	owner = {
		change_variable = {
			which = num_of_adm_clicks
			value = 1
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = ARB_extra_base_tax
			}
		}
		owner = {
			random_owned_province = {
				add_base_tax = 1
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				has_reform = west_slavic_monarchy
			}
		}
		if = {
			limit = {
				culture = slovak
			}
			owner = {
				change_variable = { ME_slovak_loyalty = 0.5 }
			}
		}
		else_if = {
			limit = {
				culture = polish
			}
			owner = {
				change_variable = { ME_polish_loyalty = 0.5 }
			}
		}
		else_if = {
			limit = {
				culture = czech
			}
			owner = {
				change_variable = { ME_czech_loyalty = 0.5 }
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				OR = {
					has_reform = me_hofkammer_reform
					has_country_flag = 20_percent_chance_for_extra_dev
				}
			}
		}
		random = { 
			chance = 20
			
			add_base_tax = 1
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_hab_increase_minority_loyalty_through_development
			}
			OR = {
				area = moravia_area
				area = bohemia_area
				area = erzgebirge_area
				area = transdanubia_area
				area = alfold_area
				area = slovakia_area
			}
		}
		owner = {
			add_estate_loyalty = {
				estate = me_estate_cultural_minorities
				loyalty = 1
			}
		}
	}
	
	if = {
		limit = {
			culture = armenian
			owner = {
				OR = {
					has_mission = QAR_catholicoi
					tag = QAR
					was_tag = QAR
				}
			}
		}
		owner = {
			change_variable = {
				which = QAR_developed_armenia
				value = 1
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_modifier = me_hab_imperial_treasurer
			}
		}
		emperor = {
			add_imperial_influence = 1
		}
	}

	if = { 
		limit = { 
			owner = { mission_completed = slo_lightning } 
		}
		random_list = { 
			10 = { add_base_tax = 1 } 
			90 = { } 
		}
	}
	if = {
		limit = {
			province_has_center_of_trade_of_level = 1
			owner = {
				has_country_flag = ORM_deving_adm_in_trade_centers
			}
		}
		owner = {
			add_mercantilism = 1
		}
	}

	if = {
		limit = {
			owner = {
				has_country_flag = me_mug_urbanization_begin
			}
			development = 30
			NOT = {
				has_province_modifier = me_mug_urban_centre
			}
		}
		add_province_modifier = {
			name = me_mug_urban_centre
			duration = -1
		}
	}
	if = {
        limit = {
			owner = {
				has_country_flag = me_mug_dashala
			}
        }
        random = {
            chance = 50
            add_base_tax = 1
        }
    }
	#if = {
	#	limit = {
	#		owner = { mission_completed = EE_syn_development_efforts }
	#	}
	#	add_base_tax = 1
	#}
}

# province
on_dip_development = {
	# ME Stuff
	ME_on_development = yes
	if = {
		limit = {
			owner = {
				has_reform = west_slavic_monarchy
			}
		}
		if = {
			limit = {
				culture = slovak
			}
			owner = {
				change_variable = { ME_slovak_loyalty = 0.5 }
			}
		}
		else_if = {
			limit = {
				culture = polish
			}
			owner = {
				change_variable = { ME_polish_loyalty = 0.5 }
			}
		}
		else_if = {
			limit = {
				culture = czech
			}
			owner = {
				change_variable = { ME_czech_loyalty = 0.5 }
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_mug_grain_double_dev
			}
		}
		random = { 
			chance = 50 

			add_base_production = 1
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_mug_urbanization_begin
			}
			development = 30
			NOT = {
				has_province_modifier = me_mug_urban_centre
			}
		}
		add_province_modifier = {
			name = me_mug_urban_centre
			duration = -1
		}
	}
	
	if = {
		limit = {
			owner = {
				OR = {
					has_reform = me_hofkammer_reform
					has_country_flag = 20_percent_chance_for_extra_dev
				}
			}
		}
		random = { 
			chance = 20
			
			add_base_production = 1
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_hab_increase_minority_loyalty_through_development
			}
			OR = {
				area = moravia_area
				area = bohemia_area
				area = erzgebirge_area
				area = transdanubia_area
				area = alfold_area
				area = slovakia_area
			}
		}
		owner = {
			add_estate_loyalty = {
				estate = me_estate_cultural_minorities
				loyalty = 1
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_modifier = me_hab_imperial_treasurer
			}
		}
		emperor = {
			add_imperial_influence = 1
		}
	}
	
	if = { 
		limit = { 
			owner = { mission_completed = slo_lightning } 
		}
		random_list = { 
			10 = { add_base_production = 1 } 
			90 = { } 
		}
	}
	#if = {
	#	limit = {
	#		owner = { mission_completed = EE_syn_development_efforts }
	#	}
	#	add_base_production = 1
	#}

	if = {
		limit = {
			culture = armenian
			owner = {
				OR = {
					has_mission = QAR_catholicoi
					tag = QAR
					was_tag = QAR
				}
			}
		}
		owner = {
			change_variable = {
				which = QAR_developed_armenia
				value = 1
			}
		}
	}
}

# province
on_mil_development = {
	# ME Stuff 
	ME_on_development = yes
	if = {
		limit = {
			owner = {
				has_reform = west_slavic_monarchy
			}
		}
		if = {
			limit = {
				culture = slovak
			}
			owner = {
				change_variable = { ME_slovak_loyalty = 0.5 }
			}
		}
		else_if = {
			limit = {
				OR = {
					culture = polish
					culture = schlesian
				}
			}
			owner = {
				change_variable = { ME_polish_loyalty = 0.5 }
			}
		}
		else_if = {
			limit = {
				culture = czech
			}
			owner = {
				change_variable = { ME_czech_loyalty = 0.5 }
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				OR = {
					has_reform = me_hofkammer_reform
					has_country_flag = 20_percent_chance_for_extra_dev
				}
			}
		}
		random = { 
			chance = 20
			
			add_base_manpower = 1
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_hab_increase_minority_loyalty_through_development
			}
			OR = {
				area = moravia_area
				area = bohemia_area
				area = erzgebirge_area
				area = transdanubia_area
				area = alfold_area
				area = slovakia_area
			}
		}
		owner = {
			add_estate_loyalty = {
				estate = me_estate_cultural_minorities
				loyalty = 1
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_modifier = me_hab_imperial_treasurer
			}
		}
		emperor = {
			add_imperial_influence = 1
		}
	}
	
	if = { 
		limit = { 
			owner = { mission_completed = slo_lightning } 
		}
		random_list = { 
			10 = { add_base_manpower = 1 } 
			90 = { } 
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_mug_urbanization_begin
			}
			development = 30
			NOT = {
				has_province_modifier = me_mug_urban_centre
			}
		}
		add_province_modifier = {
			name = me_mug_urban_centre
			duration = -1
		}
	}

	if = {
		limit = {
			owner = { mission_completed = ME_tim_national_militias }
		}
		random_list = { 
			10 = { add_base_manpower = 1 } 
			90 = { } 
		}
	}
	#if = {
	#	limit = {
	#		owner = { mission_completed = EE_syn_development_efforts }
	#	}
	#	add_base_manpower = 1
	#}

	if = {
		limit = {
			culture = armenian
			owner = {
				OR = {
					has_mission = QAR_catholicoi
					tag = QAR
					was_tag = QAR
				}
			}
		}
		owner = {
			change_variable = {
				which = QAR_developed_armenia
				value = 1
			}
		}
	}
}

on_province_culture_converted = {
	# ME Stuff
	
	if = {
		limit = {
			owner = {
				has_reform = west_slavic_monarchy
			}
		}
		if = {
			limit = {
				culture = slovak
			}
			owner = {
				change_variable = { ME_slovak_loyalty = 1 }
			}
		}
		else_if = {
			limit = {
				OR = {
					culture = polish
					culture = schlesian
				}
			}
			owner = {
				change_variable = { ME_polish_loyalty = 1 }
			}
		}
		else_if = {
			limit = {
				culture = czech
			}
			owner = {
				change_variable = { ME_czech_loyalty = 1 }
			}
		}
	}
	owner = {
		change_variable = { num_of_culture_converted_provinces = 1 }
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_hab_dev_cost_in_foreign_culture_provinces
			}
			culture_group = ROOT
		}
		remove_province_modifier = me_hab_development_law
	}
	else_if = {
		limit = {
			owner = {
				has_country_flag = me_hab_dev_cost_in_foreign_culture_provinces
			}
			NOT = { culture_group = ROOT }
		}
		add_province_modifier = {
			name = me_hab_development_law
			duration = -1
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_hab_conscription_on_foreign_provinces
			}
			culture_group = ROOT
		}
		remove_province_modifier = me_hab_conscription_law
	}
	else_if = {
		limit = {
			owner = {
				has_country_flag = me_hab_conscription_on_foreign_provinces
			}
			NOT = { culture_group = ROOT }
		}
		add_province_modifier = {
			name = me_hab_conscription_law
			duration = -1
		}
	}
	
	#if = {
	#	limit = {
	#		owner = {
	#			has_estate_privilege = estate_turkic_tribes_settle_the_tribes
	#		}
	#		culture = owner
	#	}
	#	owner = {
	#		add_estate_loyalty = {
	#			estate = estate_turkic_tribes
	#			loyalty = 5
	#		}
	#	}
	#}
	
	if = {
		limit = {
			owner = {
				has_country_modifier = me_tim_persian_empire
				primary_culture = persian
			}
			
		}
		add_province_modifier = {
			name = me_tim_persian_empire_province
			duration = -1
			hidden = yes
		}
	}
	else_if = {
		limit = {
			owner = {
				has_country_modifier = me_tim_persian_empire
				NOT = { primary_culture = persian }
			}
		}
		remove_province_modifier = me_tim_persian_empire_province
	}
}

on_primary_culture_changed = {
	if = {
		limit = {
			primary_culture = persian
			NOT = { has_country_modifier = me_tim_persian_empire }
			has_country_flag = me_tim_persian_empire_flag
		}
		add_country_modifier = {
			name = me_tim_persian_empire
			duration = -1
			desc = me_tim_until_we_are_not_persian
		}
		every_owned_province = {
			limit = {
				culture = ROOT
			}
			add_province_modifier = {
				name = me_tim_persian_empire_province
				duration = -1
				hidden = yes
			}
		}
	}
	else_if = {
		limit = {
			NOT = { primary_culture = persian }
			has_country_modifier = me_tim_persian_empire
		}
		remove_country_modifier = me_tim_persian_empire
		set_country_flag = me_tim_persian_empire_flag
		every_owned_province = {
			limit = {
				culture = ROOT
			}
			remove_province_modifier = me_tim_persian_empire_province
		}
	}
}

# ROOT = winning country, FROM = loser country
on_battle_won_country = {
	#ME Stuff
	#if = {
	#	limit = {
	#		mission_completed = EE_syn_robot_army
	#	}
	#	add_adm_power = 10
	#	add_dip_power = 10
	#	add_mil_power = 10
	#}
	#if = {
	#	limit = {
	#		tag = ILK
	#		FROM = {
	#			tag = MAM
	#		}
	#	}
	#	country_event = { id = ME_Ilkhanate_Events.8 }
	#}
	if = {
		limit = {
			mission_completed = takeda_rise_of_takeda_shingen
		}
		change_variable = { which = num_of_won_battles value = 1 }
	}
	
	if = {
		limit = {
			has_country_modifier = me_hab_imperial_marshall
		}
		emperor = {
			add_imperial_influence = 1
		}
	}
	if = {
		limit = {
			has_country_flag = GRA_incident_castile
			FROM = { tag = CAS }
		}
		change_variable = { which = Granada_battles_won value = 1 }
	}
	if = {
		limit = {
			has_country_modifier = MSY_the_end_is_nigh
		}
		add_disaster_progress = {
			disaster = ME_the_end_of_times
			value = -0.5
		}
	}
	if = {
		limit = {
			has_country_flag = RUM_pp_from_battles
			variable_arithmetic_trigger = {
				export_to_variable = {
					which = RUM_our_discipline
					value = trigger_value:discipline
				}
				export_to_variable = {
					which = RUM_their_discipline
					value = trigger_value:discipline
					who = FROM
				}
				check_variable = {
					which = RUM_their_discipline
					which = RUM_our_discipline
				}
			}
		}
		add_power_projection = {
			type = RUM_battles
			amount = 1
		}
	}
	if = {
		limit = {
			has_country_flag = ME_can_use_timurid_legitimacy
		}
		change_variable = {
			which = timurid_legitimacy_value
			value = 2
		}
	}
	
	change_variable = {
		which = num_of_battles_won_var
		value = 1
	}
	if = {
		limit = {
			OR = {
				AND = {
					mission_completed = TIM_every_corner
					mission_completed = TIM_elephants_for_governors
				}
				AND = {
					overlord = {
						mission_completed = TIM_every_corner
						mission_completed = TIM_elephants_for_governors
					}
				}
			}
		}
		change_variable = {
			which = METimBattlesWonFinal
			value = 1
		}
	}
	
	if = {
		limit = {
			mission_completed = TIM_conquerors_legacy
			NOT = { mission_completed = TIM_emperors_guard }
		}
		change_variable = {
			which = ME_tim_emperors_guard_counter
			value = 1
		}
	}
	if = {
		limit = {
			has_government_mechanic = conquest_frenzy
			NOT = { has_country_flag = ME_tim_battle_tendency_mission_flag }
		}
		add_government_power = { 
           		 mechanic_type = conquest_frenzy
           		 power_type = conquest_frenzy_power
          		  value = 1
       		 }
	}
	else_if = {
		limit = {
			has_government_mechanic = conquest_frenzy
			has_country_flag = ME_tim_battle_tendency_mission_flag
		}
		ME_tim_add_spoils_of_war = { add = 2 }
	}

	if = {
		limit = {
			mission_completed = ME_tim_army_with_a_state
		}
		add_government_power = {
			mechanic_type = timurid_militarization
			power_type = timurid_stratocracy_power
			value = 2
		}
	}

	if = {
		limit = {
			mission_completed = ME_tim_army_professionalism
		}
		add_army_professionalism = 0.002
	}
}

on_battle_won_unit = {
	#ME Stuff
	if = {
		limit = {
			template = me_tim_war_elephants
		}
		unit_owner = {
			change_variable = {
				which = METimElephantBattlesWon
				value = 1
			}
		}
	}
	if = {
		limit = {
			general_with_name = "Pir Budaq"
			unit_owner = {
				has_country_flag = QAR_pir_budaq_10_battles
			}
		}
		unit_owner = {
			change_variable = {
				which = QAR_pir_budaq_10_battles 
				value = 1
			}
		}
	}
	#if = {
	#	limit = {
	#		general_with_name = "Pir Budaq"
	#		unit_owner = {
	#			has_country_flag = QAR_pir_budaq_10_battles
	#		}
	#		unit_owner = {
	#			check_variable = {
	#				which = QAR_pir_budaq_10_battles
	#				value = 10
	#			}
	#		}
	#	}
	#	unit_owner = {
	#		clr_country_flag = QAR_pir_budaq_10_battles
	#		set_variable = {
	#			which = QAR_pir_budaq_10_battles
	#			value = 0
	#		}
	#		country_event = { id = ME_Qara_Qoyunlu_Events.27 days = 2 }
	#	}
	#}
	if = {
        limit = {
            unit_owner = {
                has_country_flag = ME_tim_battle_tendency_mission_flag
            }
            is_ruler_commanding_unit = yes
        }
        unit_owner = {
            add_estate_loyalty = {
				estate = estate_nomadic_tribes
				loyalty = 5
			}
        }
    }

	if = {
        limit = {
            unit_owner = {
                has_country_flag = me_tim_ruler_victories_give_reform_progress
            }
            is_ruler_commanding_unit = yes
        }
        unit_owner = {
            change_government_reform_progress = 1
        }
    }
}
# THIS = Province, FROM = Country, ROOT = Merc Unit #DOGE - useless since nothing changed/I use it
#on_mercenary_recruited = {
#	on_mercenary_recruited_effect = yes
#}

on_culture_promoted = {
	if = {
		limit = {
			has_government_mechanic = habsburg_glory
		}
		HAB_change_habsburg_glory = { amount = 5 }
	}
}

on_culture_demoted = {
	if = {
		limit = {
			has_government_mechanic = habsburg_glory
		}
		HAB_change_habsburg_glory = { amount = -7 }
	}
}

on_weak_heir_claim = {
	if = {
		limit = {
			has_government_mechanic = habsburg_glory
		}
		HAB_change_habsburg_glory = { amount = -5 }
	}
}

on_successive_emperor  = {
	if = {
		limit = {
			has_government_mechanic = habsburg_glory
		}
		HAB_change_habsburg_glory = { amount = 2 }
	}
}

#on_four_year_pulse_4 = {
#	random_events = {
#		# Board of Personnel chain
#		100 = ME_Manchu_Events.17
#		100 = ME_Manchu_Events.18
#		100 = ME_Manchu_Events.19
#
#		# Bourd of Revenue chain
#		100 = ME_Manchu_Events.21
#		100 = ME_Manchu_Events.22
#		100 = ME_Manchu_Events.23
#	}
#}

on_golden_bull_enacted = {	
	#ME Stuff
	if = {
		limit = {
			has_country_flag = me_pi_from_bulls
		}
		add_papal_influence = 30
	}
}

on_battle_lost_unit = {
	if = {
		limit = {
			unit_owner = {
				tag = BUR
			}
			enemy_unit = {
				unit_owner = {
					has_country_flag = me_bur_beating_bur_king_in_battle
				}
			}
		}
		unit_owner = {
			random = { 
				chance = 10
				
				country_event = { id = incidents_bur_inheritance.1 }
			}
		}
	}
}

on_general_recruited = {
	if = {
		limit = {
			has_country_modifier = me_hab_general_staff
		}
		add_army_tradition = 2
		if = {
			limit = {
				num_of_generals = 10
				NOT = { has_country_modifier = me_hab_staff_planning }
			}
			add_country_modifier = {
				name = me_hab_staff_planning
				duration = -1
			}
		}
	}

	if = {
		limit = {
			mission_completed = ME_tim_military_loyalty
		}
		add_army_professionalism = 0.01
	}
}

# province:  spawned whenever a new owner takes over the province
# FROM = The previous owner.
on_conquest = {
	#ME Stuff
	
	if = {
		limit = {
			owner = { has_country_flag = me_hab_venetian_modifier }
		}
		if = {
			limit = {
				venetia_area = {
					type = all
					owned_by = ROOT
				}
			}
			owner = {
				add_country_modifier = {
					name = me_hab_venetian_sailors
					duration = -1
				}
			}
		}
		else_if = {
			limit = {
				NOT = {
					venetia_area = {
						type = all
						owned_by = ROOT
					}
				}
			}
			FROM = {
				remove_country_modifier = me_hab_venetian_sailors
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				NOT = { has_country_flag = me_hab_dev_cost_in_foreign_culture_provinces }
			}
			has_province_modifier = me_hab_development_law
		}
		remove_province_modifier = me_hab_development_law
	}
	else_if = {
		limit = {
			owner = {
				has_country_flag = me_hab_dev_cost_in_foreign_culture_provinces
			}
			NOT = { has_province_modifier = me_hab_development_law }
		}
		add_province_modifier = {
			name = me_hab_development_law
			duration = -1
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_modifier = MSY_the_end_is_nigh
			}
		}
		owner = {
			add_disaster_progress = {
				disaster = ME_the_end_of_times
				value = -0.3
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				NOT = { has_country_flag = me_hab_conscription_on_foreign_provinces }
			}
			has_province_modifier = me_hab_conscription_law
		}
		remove_province_modifier = me_hab_conscription_law
	}
	else_if = {
		limit = {
			owner = {
				has_country_flag = me_hab_conscription_on_foreign_provinces
			}
			NOT = { has_province_modifier = me_hab_conscription_law }
		}
		add_province_modifier = {
			name = me_hab_conscription_law
			duration = -1
		}
	}
	
	if = {
		limit = {
			FROM = {
				has_country_modifier = me_hab_iberian_ties
				has_country_flag = me_hab_iberian_ties_flag
			}
			NOT = {
				iberia_region = {
					type = all
					country_or_non_sovereign_subject_holds = ROOT
				}
			}
		}
		remove_country_modifier = me_hab_iberian_ties
	}
	else_if = {
		limit = {
			FROM = {
				has_country_flag = me_hab_iberian_ties_flag
				NOT = { has_country_modifier = me_hab_iberian_ties }
			}
			iberia_region = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT
			}
		}
		add_country_modifier = {
			name = me_hab_iberian_hegemony
			duration = -1
		}
	}

	if = {
		limit = {
			owner = {
				has_country_flag = me_tim_horde_path
			}
		}
		owner = {
			change_variable = {
				which = METimConquestHorde
				value = 1
			}
		}
	}

	if = {
		limit = {
			owner = {
				has_country_modifier = ME_tim_horsemen_of_apocalypse_modifier
			}
			development = 3
		}
		add_base_tax = 1
	}
	
	if = {
		limit = {
			religion = ROOT
			ME_caliph_tag_trigger = {
				trigger = "
					religion = ROOT
				"
			}
			is_fatwa_active = {
				fatwa = permit_taqiyya
			}
		}
		add_nationalism = -10
	}
}

# country
# root = winning country, from = loser country
on_war_won = {
	#ME Stuff
	if = {
		limit = {
			has_country_modifier = me_tim_stampede_the_traitor 
			NOT = {
				war_with = QOM
			}
		}
		remove_country_modifier = me_tim_stampede_the_traitor
	}
	
	if = {
		limit = {
			FROM = {
				capital_scope = {
					OR = {
						area = lower_swabia_area
						area = upper_swabia_area
					}
				}
			}
		}
		FROM = {
			set_country_flag = me_hab_beaten_by_habsburgs
		}
		change_variable = {
			which = meBeatSwabians
			value = 1
		}
	}
	
	if = {
		limit = {
			has_country_flag = me_hab_von_haugwitz_reforms
		}
		change_variable = {
			which = MEHABWarsWon
			value = 1
		}
	}
	
	if = {
		limit = {
			has_country_flag = me_tim_win_wars
		}
		change_variable = {
			which = METimWonWars
			value = 1
		}
	}
	
	if = {
		limit = {
			mission_completed = TIM_army_reforms
		}
		change_variable = {
			which = METimWarsWon1
			value = 1
		}
	}
	
	if = {
		limit = {
			FROM = {
				capital_scope = {
					continent = europe
				}
			}
		}
		change_variable = {
			which = me_tim_europe_victory
			value = 1
		}
	}
	
	if = {
		limit = {
			has_country_flag = me_hab_von_haugwitz_reforms
			is_at_war = no
		}
		remove_country_modifier = me_hab_wartime_army
		add_country_modifier = {
			name = me_hab_peacetime_army
			duration = -1
			desc = me_as_long_as_we_are_at_peace
		}
	}
	
	if = {
		limit = {
			has_country_flag = me_hab_hofkriegstrat_flag
			is_at_war = no
		}
		remove_country_modifier = me_hab_war_council
	}
	
	if = {
		limit = {
			FROM = {
				capital_scope = {
					is_part_of_hre = no
				}
			}
		}
		change_variable = {
			which = MEHabBeatenEnemies
			value = 1
		}
	}
	if = {
		limit = {
			FROM = {
				NOT = { religion = ROOT }
			}
		}
		change_variable = {
			which = ME_num_of_heathen_heretic_wars_won
			value = 1
		}
	}
		
	
	if = {
		limit = {
			has_global_flag = imperial_treasurer_established
			NOT = {
				any_known_country = {
					has_country_modifier = me_hab_imperial_treasurer
				}
			}
		}
		clr_global_flag = imperial_treasurer_established
	}
	
	if = {
		limit = {
			has_global_flag = imperial_marshall_established
			NOT = {
				any_known_country = {
					has_country_modifier = me_hab_imperial_marshall
				}
			}
		}
		clr_global_flag = imperial_marshall_established
	}
	
	if = {
		limit = {
			has_global_flag = imperial_court_chaplain_established
			NOT = {
				any_known_country = {
					has_country_modifier = me_hab_imperial_court_chaplain
				}
			}
		}
		clr_global_flag = imperial_court_chaplain_established
	}
	
	if = {
		limit = {
			NOT = { has_country_flag = me_hab_won_against_swiss }
			tag = HAB
			FROM = {
				tag = SWI
			}
		}
		set_country_flag = me_hab_won_against_swiss
	}
	
	if = {
		limit = {
			tag = TUN
			FROM = {
				has_country_flag = TUN_abu_l_hasan
				ai = yes 
			}
		}
		add_yearly_manpower = 1.5
		FROM = {
			every_owned_province = {
				random_core_country = {
					every_core_province = {
						limit = {
							owned_by = FROM
						}
						cede_province = PREV
					}
				}
			}
			random_neighbor_country = {
				limit = {
					ai = yes
				}
				save_event_target_as = TUN_annex_us
			}
			if = {
				limit = {
					has_saved_event_target = TUN_annex_us
				}
				every_owned_province = {
					add_core = ROOT
					cede_province = event_target:TUN_annex_us
				}
			}
		}
	}
	else_if = {
		limit = {
			has_country_flag = TUN_abu_l_hasan
			FROM = {
				tag = TUN
				ai = yes 
			}
		}
		if = {
			limit = {
				NOT = { exists = TRP }
			}
			FROM = { change_tag = TRP on_change_tag_effect = yes }
		}
		remove_country_modifier = TUN_abu_l_hasans_rebellion_modifier
	}
	else = { }
	
	if = {
		limit = {
			has_global_flag = GHD_some_nation_set_west_africa_on_fire
			technology_group = sub_saharan 
			FROM = {
				technology_group = sub_saharan 
			}
		}
		every_country = {
			# every_trade_node_member_country = {
			limit = {
				has_country_flag = GHD_nations_in_west_africa_fighting_wars_buff_us
				NOT = { tag = FROM }
				NOT = { tag = ROOT }
				OR = {
					1132 = {
						has_merchant = PREV
					}
					1149 = {
						has_merchant = PREV
					}
				}
			}
			export_to_variable = {
				variable_name = ROOT_dev
				value = total_development
				who = ROOT
			}
			export_to_variable = {
				variable_name = PREV_dev
				value = total_development
				who = PREV
			}
			change_variable = {
				which = ROOT_dev
				which = PREV_dev
			}
			while = {
				limit = {
					check_variable = {
						which = ROOT_dev
						value = 1
					}
				}
				subtract_variable = {
					which = ROOT_dev
					value = 1
				}
				add_treasury = 1
				add_manpower = 0.025
			}
			set_variable = {
				which = ROOT_dev
				value = 0
			}
			set_variable = {
				which = PREV_dev
				value = 0
			}
		}
	}
	if = {
		limit = {
			has_global_flag = YEM_relationship
			has_saved_global_event_target = YEM_target
			has_saved_global_event_target = YEM_beneficiary
		}
		if = {
			limit = {
				tag = event_target:YEM_target
			}
			event_target:YEM_beneficiary = {
				add_dip_power = 50
				add_mil_power = 50
			}
		}
	}
	
	if = {
		limit = {
			has_country_modifier = MSY_the_end_is_nigh
			FROM = { 
				NOT = { religion = ROOT }
			}
		}
		add_disaster_progress = {
			disaster = ME_the_end_of_times
			value = -2.5
		}
	}
	
	if = {
		limit = {
			has_reform = timurid_prince
			any_country = {
				dynasty = ROOT
				is_subject_of = ROOT
				has_opinion_modifier = {
					who = ROOT
					modifier = TIM_sibling_rivalry
				}
			}
		}
		every_known_country = {
			limit = {
				dynasty = ROOT
				is_subject_of = ROOT
				has_opinion_modifier = {
					who = ROOT
					modifier = TIM_sibling_rivalry
				}
			}
			remove_opinion = {
				who = ROOT
				modifier = TIM_sibling_rivalry
			}
			reverse_remove_opinion = {
				who = ROOT
				modifier = TIM_sibling_rivalry
			}
		}
	}
	
	if = {
		limit = {
			tag = TIM
			has_country_flag = me_tim_flight_to_india
			any_owned_province = {
				superregion = india_superregion
			}
		}
		country_event = { id = ME_Timurid_Succession_Crisis_Events.10 }
	}
	
	if = {
		limit = {
			tag = AFG
			is_subject = no
			NOT = { has_country_flag = me_afg_babur_arrival }
		}
		set_country_flag = me_afg_babur_arrival
		country_event = { id = ME_Timurid_Princes_Event.26 days = 32 }
	}
	
	if = {
		limit = {
			has_country_flag = me_tim_win_wars
		}
		change_variable = {
			which = METimWonWars
			value = 1
		}
	}

	if = {
		limit = {
			NOT = {
				exists = TIM
			}
			any_province = {
				has_province_flag = me_tim_wasteland
			}
		}
		every_province = {
			limit = {
				has_province_flag = me_tim_wasteland
			}
			clr_province_flag = me_tim_wasteland
		}
	}
}

on_force_conversion = {
	if = {
		limit = {
			FROM = {
				has_country_modifier = MSY_the_end_is_nigh
			}
		}
		FROM = {
			add_disaster_progress = {
				disaster = ME_the_end_of_times
				value = -2.5
			}
		}
	}
	
	if = {
		limit = {
			technology_group = western
			FROM = {
				has_country_flag = ARB_islamization_of_europe_cb
			}
		}
		add_power_projection = {
			type = ARB_islamization_of_europe
			amount = 5
		}
	}
	
	if = {
		limit = {
			FROM = { has_country_flag = RUM_conversion }
		}
		FROM = { add_adm_power = 50 }
	}
}

on_startup = {
	#set_global_flag = paradox_or_mod_missions_events_flag
	#set_initial_estate_decision = yes
	
	if = {
		limit = {
			tag = event_target:Caliph_province_holder
		}
		ME_check_caliphal_influence_modifiers = yes
	}
	
	events = {
		#ME_Qara_Qoyunlu_Events.10
        #missions_expanded_events.5
		###paradox_or_mod_missions_events.2
	}
	
	361 = { 
		province_event = { id = ME_Abbasid_Events.1 }
	}
	
}

on_add_pasha = {	
	#ME Stuff
	hidden_effect = {
		owner = {
			save_event_target_as = province_owner
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = RUM_pasha_empowerment
			}
		}
		area = {
			limit = {
				owned_by = event_target:province_owner
			}
			add_province_modifier = {
				name = RUM_pasha_modifier
				duration = -1
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = RUM_pasha_seljuk_flag
			}
		}
		area = {
			limit = {
				owned_by = event_target:province_owner
			}
			add_province_modifier = {
				name = RUM_pasha_seljuk_modifier
				duration = -1
			}
		}
	}
	else_if = {
		limit = {
			owner = {
				has_country_flag = RUM_pasha_roman_flag
			}
		}
		area = {
			limit = {
				owned_by = event_target:province_owner
			}
			add_province_modifier = {
				name = RUM_pasha_roman_modifier
				duration = -1
			}
		}
	}
	else_if = {
		limit = {
			owner = {
				has_country_flag = RUM_pasha_caliphate_modifier
			}
		}
		area = {
			limit = {
				owned_by = event_target:province_owner
			}
			#add_province_modifier = { @stiopa to fix this
			#	name = RUM_pasha_caliphate_flag 
			#	duration = -1
			#}
		}
	}
	else = { }
}

# THIS = One province in the state
on_remove_pasha = {
	hidden_effect = {
		owner = {
			save_event_target_as = province_owner
		}
	}
	
	area = {
		limit = { owned_by = event_target:province_owner }
		add_or_extend_province_modifier_effect = { MODIFIER = pasha_removed_modifier DURATION = 3650 }
		remove_province_modifier = RUM_pasha_modifier
		remove_province_modifier = RUM_pasha_seljuk_modifier
		remove_province_modifier = RUM_pasha_roman_modifier
		remove_province_modifier = RUM_pasha_caliphate_modifier
	}
}

#on_janissaries_raised = {
#	owner = {
#		if = {
#			limit = { #DISABLED AND NERFED RUM
#				has_country_flag = RUM_cost_of_janissaries_decreased
#			}
#			add_mil_power = 6
#		}
#	}
#}

#on_four_year_pulse_4 = {
#	random_events = {
#		# Board of Personnel chain
#		100 = ME_Manchu_Events.17
#		100 = ME_Manchu_Events.18
#		100 = ME_Manchu_Events.19
#
#		# Bourd of Revenue chain
#		100 = ME_Manchu_Events.21
#		100 = ME_Manchu_Events.22
#		100 = ME_Manchu_Events.23
#	}
#}

# country
# root = winning country, from = location
on_siege_won_country = {
	if = {
		limit = {
			FROM = {
				OR = {
					region = malaya_region
					region = indonesia_region
				}
				controller = {
					has_country_flag = me_mug_expedition_start
				}
			}
		}
		FROM = {
			save_global_event_target_as = expedition_spawn
		}
		country_event = { id = ME_Mughal_Events.25 }
		clr_country_flag = me_mug_expedition_start
	}
	
	#Hindu Subah
	if = {
		limit = {
			has_ruler_flag = me_mug_hindustan_focus
			FROM = {
				province_id = 522
				NOT = { owned_by = ROOT }
			}
		}
		remove_country_modifier = me_mug_hindu_subah
		add_ruler_modifier = {
			name = me_mug_hindu_subah_negative
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_ruler_flag = me_mug_hindustan_focus
			FROM = {
				province_id = 522
				owned_by = ROOT
			}
		}
		remove_country_modifier = me_mug_hindu_subah_negative
		add_ruler_modifier = {
			name = me_mug_hindu_subah
			duration = -1
		}
	}
	
	#Bengal Subah
	if = {
		limit = {
			has_ruler_flag = me_mug_bengal_focus
			FROM = {
				province_id = 563
				NOT = { owned_by = ROOT }
			}
		}
		remove_country_modifier = me_mug_bengal_subah
		add_ruler_modifier = {
			name = me_mug_bengal_subah_negative
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_ruler_flag = me_mug_bengal_focus
			FROM = {
				province_id = 563
				owned_by = ROOT
			}
		}
		remove_country_modifier = me_mug_bengal_subah_negative
		add_ruler_modifier = {
			name = me_mug_bengal_subah
			duration = -1
		}
	}
	
	#Rajput Subah
	if = {
		limit = {
			has_ruler_flag = me_mug_rajput_focus
			FROM = {
				province_id = 2087
				NOT = { owned_by = ROOT }
			}
		}
		remove_country_modifier = me_mug_rajput_subah
		add_ruler_modifier = {
			name = me_mug_rajput_subah_negative
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_ruler_flag = me_mug_rajput_focus
			FROM = {
				province_id = 2087
				owned_by = ROOT
			}
		}
		remove_country_modifier = me_mug_rajput_subah_negative
		add_ruler_modifier = {
			name = me_mug_rajput_subah
			duration = -1
		}
	}
	
	#Gujarat Subah
	if = {
		limit = {
			has_ruler_flag = me_mug_gujarat_focus
			FROM = {
				province_id = 2054
				NOT = { owned_by = ROOT }
			}
		}
		remove_country_modifier = me_mug_gujarat_subah
		add_ruler_modifier = {
			name = me_mug_gujarat_subah_negative
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_ruler_flag = me_mug_gujarat_focus
			FROM = {
				province_id = 2054
				owned_by = ROOT
			}
		}
		remove_country_modifier = me_mug_gujarat_subah_negative
		add_ruler_modifier = {
			name = me_mug_gujarat_subah
			duration = -1
		}
	}
	
	#Malwa Subah
	if = {
		limit = {
			has_ruler_flag = me_mug_malwa_focus
			FROM = {
				province_id = 526
				NOT = { owned_by = ROOT }
			}
		}
		remove_country_modifier = me_mug_malwa_subah_bonus
		add_ruler_modifier = {
			name = me_mug_malwa_subah_negative
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_ruler_flag = me_mug_malwa_focus
			FROM = {
				province_id = 526
				owned_by = ROOT
			}
		}
		remove_country_modifier = me_mug_malwa_subah_negative
		add_ruler_modifier = {
			name = me_mug_malwa_subah_bonus
			duration = -1
		}
	}
	
	#Deccan Subah
	if = {
		limit = {
			has_ruler_flag = me_mug_deccan_focus
			FROM = {
				province_id = 541
				NOT = { owned_by = ROOT }
			}
		}
		remove_country_modifier = me_mug_deccan_subah_bonus
		add_ruler_modifier = {
			name = me_mug_deccan_subah_bonus_negative
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_ruler_flag = me_mug_malwa_focus
			FROM = {
				province_id = 541
				owned_by = ROOT
			}
		}
		remove_country_modifier = me_mug_deccan_subah_bonus_negative
		add_ruler_modifier = {
			name = me_mug_deccan_subah_bonus
			duration = -1
		}
	}

	if = {
		limit = {
			from = { fort_level = 1 }
		}
		change_variable = {
			which = num_of_sieges_won
			value = 1
		}
	}
}

on_siege_won_province = {
	#ME Stuff
	
	if = {
		limit = {
			culture = andalucian
			controller = {
				capital_scope = {
					region = maghreb_region
				}
				is_in_war = {
					casus_belli = cb_oran_fatwa
				}
			}
			from = {
				religion_group = christian
			}
		}
		controller = {
			ROOT = { save_event_target_as = Tunis_the_province }
			country_event = { id = ME_Tunis_Events.13 }
		}
	}
}

on_capital_moved = {
	if = {
		limit = {
			has_country_modifier = me_mug_capital_of_agra
			524 = {
				has_province_modifier = me_mug_capital_city
			}
			NOT = { capital = 524 }
		}
		remove_country_modifier = me_mug_capital_of_agra
		524 = {
			remove_province_modifier = me_mug_capital_city
		}
	}
	else_if = {
		limit = {
			has_country_flag = me_mug_agra_capital_bonuses
			NOT = { has_country_modifier = me_mug_capital_of_agra }
			524 = {
				NOT = { has_province_modifier = me_mug_capital_city }
			}
			capital = 524
		}
		add_country_modifier = {
			name = me_mug_capital_of_agra
			duration = -1
		}
		524 = {
			add_province_modifier = {
				name = me_mug_capital_city
				duration = -1
			}
		}
	}
}

#on_four_year_pulse_3 = { #for our nobles # Moved to on_actions
#	random_events = {
#		1000 = 0
#		100 = me_austria_nobles.2
#		100 = me_austria_nobles.3
#		750 = decadence.1
#		750 = decadence.2
#		750 = decadence.3
#		750 = decadence.4
#		750 = decadence.5
#		750 = decadence.6
#		750 = decadence.7
#		750 = decadence.8
#		750 = decadence.9
#		750 = decadence.10
#	}
#}

# province
on_province_religion_converted = {
	#ME Stuff
	if = {
		limit = {
			owner = {
				has_country_modifier = me_hab_imperial_court_chaplain
			}
		}
		emperor = {
			add_imperial_influence = 1
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_modifier = ME_muslim_enforced_religion
			}
			# religion_group = owner 
			# NOT = { religion = owner }
		}
		export_to_variable = {
			which = ME_temp_religion_enforced
			value = trigger_value:development
		}
		while = {
			limit = {
				check_variable = {
					which = ME_temp_religion_enforced
					value = 1
				}
			}
			owner = {
				add_piety = 0.02
			}
			change_variable = {
				which = ME_temp_religion_enforced
				value = -1
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_modifier = MSY_the_end_is_nigh
			}
		}
		export_to_variable = {
			which = MSY_temp
			value = trigger_value:development
		}
		while = {
			limit = {
				check_variable = {
					which = MSY_temp
					value = 1
				}
			}
			owner = {
				add_disaster_progress = {
					disaster = ME_the_end_of_times
					value = -0.2
				}
			}
			change_variable = {
				which = MSY_temp
				value = -1
			}
		}
	}
	
	# if = {
		# limit = {
			# owner = {
				# has_country_flag = RUM_piety_from_conversion
			# }
		# }
		# export_to_variable = {
			# which = MSY_temp
			# value = trigger_value:development
		# }
		# while = {
			# limit = {
				# check_variable = {
					# which = MSY_temp
					# value = 1
				# }
			# }
			# owner = {
				# add_positive_or_negative_piety = { amount = 0.2 }
			# }
			# change_variable = {
				# which = MSY_temp
				# value = -1
			# }
		# }
	# }

	if = {
		limit = {
			owner = {
				has_country_flag = me_tim_reduced_conversion_on_razing
			}
		}
		remove_province_modifier = religious_zeal_at_conv
		add_province_modifier = {
			name = me_tim_harsh_conversions
			duration = 7300
		}
	}
}

on_center_of_trade_upgrade = {
	#ME Stuff
	if = { 
		limit = { 
			owner = { has_country_flag = tur_built_sari_markets } 
		}
		add_base_production = 1
	}

	if = {
		limit = {
			owner = {
				has_country_flag = me_mug_cot_bonus
			}
		}
		add_base_production = 2
	}
}

on_center_of_trade_downgrade = {
	#ME Stuff
	if = { 
		limit = { 
			owner = { has_country_flag = tur_built_sari_markets } 
		}
		add_base_production = -1
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_mug_cot_bonus
			}
		}
		add_base_production = -2
	}
}

# province
# FROM = old owner
on_province_owner_change = {
	#ME Stuff
	
	#if = { #Not used
	#	limit = {
	#		is_city = no
	#		OR = {
	#			owner = {
	#				NOT = { tag = FROM }
	#			}
	#			is_empty = yes
	#		}
	#	}
	#	clr_province_flag = created_through_auto_colonies
	#}
	
	if = {
		limit = {
			owner = {
				has_country_modifier = me_mug_shipbuilding_industry
			}
			trade_goods = naval_supplies
		}
		add_province_modifier = {
			name = me_mug_shipbuilding_province
			duration = -1
			hidden = yes
		}
	}
	else_if = {
		limit = {
			has_province_modifier = me_mug_shipbuilding_province
			owner = {
				NOT = {
					has_country_modifier = me_mug_shipbuilding_industry
				}
			}
		}
		remove_province_modifier = me_mug_shipbuilding_province
	}
	
	if = {
		limit = {
			owner = {
				has_estate_privilege = ME_estate_burghers_steppe_development
			}
			has_terrain = steppe
		}
		add_province_modifier = {
			name = estate_burghers_steppe_development
			duration = -1
			hidden = yes
		}
	}
	else_if = {
		limit = {
			has_province_modifier = estate_burghers_steppe_development
			owner = {
				NOT = {
					has_estate_privilege = ME_estate_burghers_steppe_development
				}
			}
		}
		remove_province_modifier = estate_burghers_steppe_development
	}
	if = {
		limit = {
			primary_culture = persian
			has_country_modifier = me_tim_persian_empire
		}
		every_owned_province = {
			limit = {
				culture = ROOT
			}
			add_province_modifier = {
				name = me_tim_persian_empire_province
				duration = -1
				hidden = yes
			}
		}
	}
	
	if = {
		limit = {
			has_saved_global_event_target = Caliph_province
			if = {
				limit = {
					has_saved_global_event_target = Caliph_province
				}
				province_id = event_target:Caliph_province
			}
			owner = {
				NOT = { religion = sunni }
			}
		}
		set_global_flag = caliph_held_by_infidels
		set_province_flag = ABA_can_take_caliph
	}	
	if = {
		limit = {
			has_saved_global_event_target = Caliph_province
			if = {
				limit = {
					has_saved_global_event_target = Caliph_province
				}
				province_id = event_target:Caliph_province
			}
			owner = {
				religion = sunni
			}
		}
		ME_set_abbasid_caliph_province = yes
		FROM = { regenerate_government_mechanics = yes }
		clr_global_flag = caliph_held_by_infidels
	}
	if = {
		limit = {
			has_saved_global_event_target = Caliph_province
			if = {
				limit = {
					has_saved_global_event_target = Caliph_province
				}
				province_id = event_target:Caliph_province
			}
			owner = {
				NOT = { religion = sunni }
			}
		}
		FROM = { regenerate_government_mechanics = yes }
		ME_set_abbasid_caliph_province = yes
	}
}

#ROOT = province that was centralized in
on_centralized_state = {
	if = {
		limit = {
			owner = {
				has_country_flag = me_mug_centralize_state_discount
			}
		}
		owner = {
			add_adm_power = 25
			change_government_reform_progress = 25
		}
	}
}

on_loan_repaid = {
	if = {
		limit = {
			has_country_flag = MAM_repaying_loans_gives_lower_inflation
		}
		add_inflation = -0.05
	}
	else_if = {
		limit = { economic_ideas = 2 }
		add_inflation = -0.05
	}
	else = { }
}

#ROOT = province
on_adm_exploited = {
	ME_on_exploit_development = yes
}
on_dip_exploited = {
	ME_on_exploit_development = yes
}
on_mil_exploited = {
	ME_on_exploit_development = yes
}

on_reform_enacted = {
	
	if = {
		limit = {
			mission_completed = ME_tim_military_administration
		}
		add_army_professionalism = 0.05
		add_army_tradition = 10
	}

	#if = {
	#	limit = {
	#		mission_completed = EE_syn_governing_capacity
	#	}
	#	add_adm_power = 100
	#	add_dip_power = 100
	#	add_mil_power = 100
	#	change_adm = 1
	#	change_dip = 1
	#	change_mil = 1
	#}
}

# province
on_consecrate_patriarch = {
	if = {
		limit = {
			NOT = { has_province_flag = ee_byz_consecrated }
			owner = {
				has_government_attribute = enables_reform_progress_on_metrapolitan
			}
		}
		area = {
			set_province_flag = ee_byz_consecrated
		}
		owner = {
			change_government_reform_progress = 10
		}
	}
}

on_monarch_death = {
	random_events = {
		900 = ME_Mamluks_Events.21
	}
	if = {
		limit = {
			tag = ERE
			mission_completed = BEY_splendid_court
		}
		random_owned_province = {
			province_event = {
				id = ME_Beylik_Events.14
			}
		}
	}
	if = {
		limit = {
			has_ruler_flag = Ulugh_beg_is_ruler
		}
		ROOT = {
			country_event = { id = ME_Timurid_Princes_Event.11 }
		}
	}
	complete_mission = me_tim_regency
	
	if = {
		limit = {
			tag = TIM
			has_global_flag = tim_successor
		}
		event_target:me_tim_successor = {
			country_event = { id = ME_Timurid_Princes_Event.20 }
		}
		clr_global_flag = tim_successor
	}
	else_if = {
		limit = {
			tag = TIM
			has_global_flag = prince_successor
		}
		event_target:me_tim_successor = {
			country_event = { id = ME_Timurid_Princes_Event.19 }
		}
		clr_global_flag = prince_successor
	}
	else_if = {
		limit = {
			tag = TIM
			has_country_flag = ME_TIM_no_successor
		}
		country_event = { id = ME_Timurid_Princes_Event.12 }
	}
	else = { } #don't complain error log.
}